<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All requests</title>
    <link rel="icon" type="image/x-icon" href="images/dashboard.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root {
            /* Navy, Teal, Sky Blue, Beige Color Palette */
            --navy: #2F4456;
            --teal: #567C8D;
            --sky-blue: #C8D9E6;
            --beige: #F5EFEB;
            --white: #FFFFFF;

            /* Functional colors */
            --primary: var(--navy);
            --secondary: var(--teal);
            --accent: var(--sky-blue);
            --background: var(--beige);
            --text-dark: #2c2c2c;
            --text-light: #5a5a5a;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--navy);
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #d32f2f;
            background-color: #ffebee;
            border-radius: 4px;
            margin: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--beige);
            min-height: 100vh;
        }

        body.modal-open {
            overflow: hidden;
            height: 100vh;
        }

        .admin-header {
            background: var(--navy);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: 7.4rem;
            position: relative;
        }

        #admin-img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-right: 15px;
            margin-top: 9px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            padding-left: 10rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            margin-left: -50px;
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 600;
            flex: 1;
            margin: 0;
            font-family: Georgia, 'Times New Roman', Times, serif;

        }

        .requests-table-container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h2 {
            color: var(--navy);
            font-size: 24px;
            font-weight: 600;
            margin-left: 30px;
        }

        .table-wrapper {
            background: white;
            border-radius: 12px 12px 0 0;
            /* ‚Üê Change this: top rounded, bottom flat */
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 16px;
            color: var(--teal);
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #e74c3c;
            background-color: #ffebee;
            border-radius: 4px;
            margin: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }

        #requests-table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        #requests-table thead {
            background: var(--navy);
            color: white;
        }

        #requests-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }

        /* Column width adjustments */
        #requests-table th:nth-child(1),
        /* Request # */
        #requests-table td:nth-child(1) {
            width: 120px;
            min-width: 120px;
        }

        #requests-table th:nth-child(2),
        /* Status */
        #requests-table td:nth-child(2) {
            width: 110px;
            min-width: 110px;
        }

        #requests-table th:nth-child(3),
        /* College / Center */
        #requests-table td:nth-child(3) {
            width: 200px;
            min-width: 200px;
        }

        #requests-table th:nth-child(4),
        /* Department */
        #requests-table td:nth-child(4) {
            width: 120px;
            min-width: 120px;
        }

        #requests-table th:nth-child(5),
        /* Location */
        #requests-table td:nth-child(5) {
            width: 130px;
            min-width: 130px;
        }

        #requests-table th:nth-child(6),
        /* Issue Description */
        #requests-table td:nth-child(6) {
            width: 250px;
            min-width: 250px;
            max-width: 300px;
        }

        #requests-table th:nth-child(7),
        /* Date */
        #requests-table td:nth-child(7) {
            width: 120px;
            min-width: 120px;
        }

        #requests-table th:nth-child(8),
        /* Amount */
        #requests-table td:nth-child(8) {
            width: 110px;
            min-width: 110px;
            text-align: center;
        }

        #requests-table tbody tr {
            border-bottom: 1px solid #e8eef3;
            transition: background-color 0.2s ease;
        }

        #requests-table tbody tr:hover {
            background-color: var(--sky-blue);
        }

        #requests-table tbody tr:last-child {
            border-bottom: none;
        }

        #requests-table td {
            padding: 16px;
            color: #2c3e50;
            font-size: 14px;
        }

        .status-waiting {
            color: #83792c;
            background-color: #f7f5dac2;
            border: 1px solid #83792c;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 12px;
        }

        .status-Approved {
            color: var(--teal);
            background-color: var(--sky-blue);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 12px;
        }

        .status-processing {
            color: var(--navy);
            background-color: var(--sky-blue);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 12px;
        }

        .status-Completed {
            color: var(--navy);
            background-color: var(--beige);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 12px;
            border: 1px solid var(--teal);
        }

        .status-rejected {
            color: #666;
            background-color: #e0e0e0;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 12px;
        }

        #requests-table td:first-child {
            font-weight: 600;
            color: var(--navy);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--navy);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Main header row - search on left, stats on right */
        .header-row {
            display: flex;
            align-items: stretch;
            gap: 86px;
            margin-bottom: 30px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 30px;
        }

        /* Stats summary */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* Creates 2 equal columns */
            gap: 20px;
            flex-direction: row;
            justify-content: flex-end;
            /* gap: 15px; */
            /* flex-wrap: nowrap;
            disables wrapping, rows all in one line */
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            width: 130px;
            height: 100px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.active {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            transform: scale(1.08);
        }


        .stat-card.total.active {
            border: 3px solid var(--navy);
            background-color: var(--sky-blue);
        }

        .stat-card.waiting.active {
            border: 3px solid #83792c;
            background-color: #f7f5dac2;
        }

        .stat-card.processing.active {
            border: 3px solid var(--teal);
            background-color: var(--beige);
        }

        .stat-card.rejected.active {
            border: 3px solid #666;
            background-color: #e0e0e0;
        }

        .stat-card h3 {
            color: #000000;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stat-card p {
            color: #2c3e50;
            font-size: 26px;
            font-weight: 700;
        }

        .stat-card.total {
            border: 2px solid var(--navy);
            background-color: var(--sky-blue);
        }

        .stat-card.waiting {
            border: 2px solid #83792c;
            background-color: #f7f5dac2;
        }

        .stat-card.processing {
            border: 2px solid var(--teal);
            background-color: var(--beige);
        }

        .stat-card.rejected {
            border: 2px solid #666;
            background-color: #e0e0e0;
        }

        /* Search and Filters Styling */
        .search-filters-container {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .search-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            /* Reduce space below the search row */
        }

        .search-bar {
            position: relative;
            flex: 1;
        }

        .search-bar input {
            width: 97%;
            padding: 10px 40px 10px 40px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(47, 68, 86, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--teal);
            font-size: 14px;
            pointer-events: none;
        }

        .clear-search {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #e0e0e0;
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            line-height: 1;
        }

        .clear-search:hover {
            background: var(--teal);
            color: white;
        }

        .clear-search.visible {
            display: flex;
        }

        .filters {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filters select,
        .filters input[type="date"] {
            padding: 8px 12px;
            border: 2px solid var(--sky-blue);
            border-radius: 8px;
            font-size: 13px;
            background-color: white;
            transition: all 0.3s ease;
            cursor: pointer;
            max-width: 300px;
        }

        .filters select:focus,
        .filters input[type="date"]:focus {
            outline: none;
            border-color: var(--navy);
            background-color: white;
        }

        .clear-btn {
            padding: 8px 16px;
            background: var(--sky-blue);
            color: var(--navy);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid var(--teal);
            font-size: 13px;
            width: 200px;
        }

        .clear-btn:hover {
            background: var(--navy);
            transform: translateY(-2px);
            color: white;
            border-color: var(--navy);
        }

        @media (max-width: 1200px) {
            .header-row {
                flex-direction: column;
            }

            .stats-container {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
            }

            .filters select,
            .filters input[type="date"] {
                width: 100%;
            }

            .stats-container {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        .account-menu {
            position: absolute;
            top: 40px;
            right: 34px;
            z-index: 1000;
        }

        .account-icon {
            width: 40px;
            height: 40px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--navy);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 2px solid var(--sky-blue);
        }

        .account-icon:hover {
            background-color: var(--beige);
            border-color: var(--teal);
            transform: scale(1.05);
        }

        .account-icon img {
            width: 50%;
            object-fit: cover;
        }

        .request-link {
            color: var(--navy);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .request-link:hover {
            color: var(--teal);
            text-decoration: underline;
        }

        .dropdown-menu {
            position: absolute;
            top: 55px;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 220px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            padding: 16px;
            border-bottom: 1px solid var(--sky-blue);
            background: var(--beige);
        }

        .dropdown-header .admin-name {
            font-weight: 600;
            color: var(--navy);
            font-size: 15px;
        }

        .dropdown-header .admin-email {
            color: var(--teal);
            font-size: 13px;
            margin-top: 4px;
        }

        .dropdown-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #333;
            text-decoration: none;
            transition: background-color 0.2s ease;
            cursor: pointer;
            font-size: 14px;
        }

        .dropdown-item .icon {
            width: 20px;
            font-size: 16px;
        }

        .dropdown-item:hover {
            background-color: var(--beige);
        }

        .dropdown-divider {
            height: 1px;
            background-color: var(--sky-blue);
            margin: 8px 0;
        }

        .dropdown-item.logout {
            color: var(--teal);
        }

        .dropdown-item.logout:hover {
            background-color: #e8f4f8;
        }

        #requestModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
        }

        /* Modal content - scrolls inside */
        #requestModal>div {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            /* ‚Üê This makes modal scroll */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            margin: auto;
        }

        #requestModal button[onclick*="closeModal"] {
            position: sticky;
            top: -15px;
            z-index: 1;
        }

        /* ‚úÖ PAGINATION STYLES */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e8eef3;
            border-radius: 0 0 12px 12px;
            /* Top flat, bottom rounded */
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            /* Matches table shadow */
        }

        .pagination-info {
            color: var(--navy);
            font-size: 14px;
            font-weight: 500;
        }

        .pagination-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .pagination-btn {
            background: var(--navy);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--teal);
            transform: translateY(-2px);
        }

        .pagination-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .page-numbers {
            display: flex;
            gap: 5px;
        }

        .page-number {
            background: var(--beige);
            color: var(--navy);
            border: 1px solid var(--sky-blue);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            min-width: 36px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .page-number:hover {
            background: var(--sky-blue);
            border-color: var(--navy);
        }

        .page-number.active {
            background: var(--navy);
            color: white;
            border-color: var(--navy);
            font-weight: 600;
        }

        .rows-per-page {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rows-per-page select {
            padding: 6px 10px;
            border: 2px solid var(--sky-blue);
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            background: white;
        }

        .rows-per-page select:focus {
            outline: none;
            border-color: var(--navy);
        }
    </style>
</head>

<body>
    <header class="admin-header">
        <div class="header-content">
            <div class="header-title">
                <img id="admin-img" src="images/dashboard.png">
                <button onclick="window.location.href='director-dashboard.html'"
                    style="background: none; border: none; cursor: pointer; padding: 0;">
                    <h1 style="color: white; margin: 0;">Director Dashboard</h1>
                </button>
            </div>
            <!-- ===== UPDATED: Account menu with dropdown ===== -->
            <div class="account-menu">
                <div class="account-icon" id="accountIcon" onclick="toggleDropdown(event)">
                    <img src="images/user.png" alt="User Account">
                </div>

                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="dropdown-header">
                        <div class="admin-name" id="adminName">Admin</div>
                        <div class="admin-email" id="adminEmail">admin@email.com</div>
                    </div>
                    <a class="dropdown-item" onclick="goToDashboard()" style="cursor: pointer;">
                        <span class="icon">üè†</span> Dashboard
                    </a>
                    <a class="dropdown-item" onclick="window.location.href='my-account.html'">
                        <span class="icon">üë§</span> My Account
                    </a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item logout" onclick="logout()">
                        <span class="icon">üö™</span> Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- REST OF YOUR HTML CONTINUES HERE... -->
    <div class="requests-table-container">
        <!-- Header row: Search/Filters on left, Stats on right -->
        <div class="header-row">
            <div class="stats-container" id="stats-container">
                <div class="stat-card total" onclick="filterByStatus('')" id="card-total">
                    <h3>Total Requests</h3>
                    <p id="stat-total">0</p>
                </div>
                <div class="stat-card waiting" onclick="filterByStatus('Waiting')" id="card-waiting">
                    <h3>waiting</h3>
                    <p id="stat-waiting">0</p>
                </div>
                <div class="stat-card processing" onclick="filterByStatus('Processing')" id="card-processing">
                    <h3>Processing</h3>
                    <p id="stat-processing">0</p>
                </div>
                <div class="stat-card rejected" onclick="filterByStatus('Rejected')" id="card-rejected">
                    <h3>rejected</h3>
                    <p id="stat-rejected">0</p>
                </div>
            </div>
            <!-- Search and Filters Section -->
            <div class="search-filters-container">
                <div class="search-row">
                    <div class="search-bar">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Search by Request #, Description, Location...">
                        <button class="clear-search" id="clearSearch" onclick="clearSearchInput()">√ó</button>
                    </div>
                </div>
                <div class="filters">
                    <select id="filterCollege">
                        <option value="">All Colleges</option>
                        <option value="College of Applied Studies">College of Applied Studies</option>
                        <option value="College of Arts">College of Arts</option>
                        <option value="College of Business Adminstration">College of Business Administration</option>
                        <option value="College of Engineering">College of Engineering</option>
                        <option value="College of Health & Sport Sciences">College of Health & Sport Sciences</option>
                        <option value="College of Information Technology">College of Information Technology</option>
                        <option value="College of Law">College of Law</option>
                        <option value="College of Science">College of Science</option>
                        <option value="Alumni Club">Alumni Club</option>
                        <option value="Business Incubator Center">Business Incubator Center</option>
                        <option value="Career Counselling Office">Career Counselling Office</option>
                        <option value="Centre D'√©tudes Fran√ßaises">Centre D'√©tudes Fran√ßaises</option>
                        <option value="Cloud Innovation Center">Cloud Innovation Center</option>
                        <option value="Community Service and Continuing Education Center">Community Service and
                            Continuing
                            Education Center</option>
                        <option value="Confucius Institiute">Confucius Institute</option>
                        <option value="E-Learning Center">E-Learning Center</option>
                        <option value="English Language Center">English Language Center</option>
                        <option value="Information Technology Center">Information Technology Center</option>
                        <option value="Information and Follow-up Office">Information and Follow-up Office</option>
                        <option value="King Sejong Institiute for Teaching Korean">King Sejong Institute for Teaching
                            Korean
                        </option>
                        <option value="Legal Clinic & Human Rights Centre">Legal Clinic & Human Rights Centre</option>
                        <option value="Media Center">Media Center</option>
                        <option value="Quality Assurance and Accrediation Centre">Quality Assurance and Accreditation
                            Centre
                        </option>
                        <option value="Unit for Teaching Excellence and Leadership">Unit for Teaching Excellence and
                            Leadership</option>
                        <option value="Yunus Emre Institiute for Teaching Turkish">Yunus Emre Institute for Teaching
                            Turkish
                        </option>
                    </select>

                    <select id="filterStatus">
                        <option value="">All Status</option>
                        <option value="Waiting">Waiting for Approval</option>
                        <option value="Approved">Approved</option>
                        <option value="Processing">Processing</option>
                        <option value="Completed">Completed</option>
                        <option value="Rejected">Rejected</option>
                    </select>

                    <input type="date" id="filterDateFrom" placeholder="From Date">
                    <input type="date" id="filterDateTo" placeholder="To Date">

                    <button id="clearFilters" class="clear-btn">Clear Filters</button>
                </div>
            </div>
        </div>


        <div class="table-header">
            <h2> Maintenance Requests</h2>
        </div>
        <div class="table-wrapper">
            <div id="loading" class="loading">Loading requests</div>
            <div id="error" class="error" style="display: none;"></div>
            <table id="requests-table" style="display: none;">
                <thead>
                    <tr>
                        <th>Request #</th>
                        <th>Status</th>
                        <th>College / Center</th>
                        <th>Department</th>
                        <th>Location</th>
                        <th>Issue Description</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="tickets-tbody">
                </tbody>
            </table>
        </div>
        <!-- ‚úÖ PAGINATION CONTROLS -->
        <div class="pagination-container" id="pagination-container" style="display: none;">
            <div class="pagination-info">
                <span id="pagination-info"></span>
            </div>
            <div class="pagination-controls">
                <div class="rows-per-page">
                    <label>Rows per page:</label>
                    <select id="rowsPerPage" onchange="changeRowsPerPage()">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <button class="pagination-btn" id="prevBtn" onclick="prevPage()">‚Üê Previous</button>
                <div class="page-numbers" id="pageNumbers"></div>
                <button class="pagination-btn" id="nextBtn" onclick="nextPage()">Next ‚Üí</button>
            </div>
        </div>
        <script>
            // Toggle dropdown open/close
            window.toggleDropdown = function (event) {
                event.stopPropagation();
                document.getElementById('dropdownMenu').classList.toggle('active');
            };

            // Close dropdown when clicking anywhere outside
            document.addEventListener('click', function (event) {
                const menu = document.getElementById('dropdownMenu');
                const icon = document.getElementById('accountIcon');
                if (!icon.contains(event.target)) {
                    menu.classList.remove('active');
                }
            });

            // Placeholder logout function ‚Äî wire up to your Firebase auth if needed
            window.logout = function () {
                if (confirm('Are you sure you want to logout?')) {
                    sessionStorage.clear();
                    localStorage.clear();
                    window.location.replace('login.html');
                }
            };
        </script>
        <script type="module">
            import { protectPage, logout } from './auth-module.js';
            import { collection, getDocs, updateDoc, doc, serverTimestamp, query, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

            // Make logout available globally
            window.logout = logout;

            let allRequestsData = [];
            let currentPage = 1;
            let rowsPerPage = 20;
            let filteredRequests = [];
            let db;

            // ‚úÖ PROTECT PAGE AND INITIALIZE
            protectPage().then(({ db: firestore, user }) => {
                console.log('‚úÖ All Requests page - User authenticated:', user.email);
                db = firestore;

                // Initialize the page
                loadRequests();
                setupEventListeners();

                // Apply URL filters after data loads
                setTimeout(applyURLFilter, 1000);

            }).catch(error => {
                console.error('Authentication failed:', error);
            });

            // ‚úÖ SETUP EVENT LISTENERS
            function setupEventListeners() {
                document.getElementById('searchInput').addEventListener('input', filterAndDisplayRequests);
                document.getElementById('filterCollege').addEventListener('change', filterAndDisplayRequests);
                document.getElementById('filterStatus').addEventListener('change', filterAndDisplayRequests);
                document.getElementById('filterDateFrom').addEventListener('change', filterAndDisplayRequests);
                document.getElementById('filterDateTo').addEventListener('change', filterAndDisplayRequests);

                document.getElementById('clearFilters').addEventListener('click', () => {
                    document.getElementById('searchInput').value = '';
                    document.getElementById('filterCollege').value = '';
                    document.getElementById('filterStatus').value = '';
                    document.getElementById('filterDateFrom').value = '';
                    document.getElementById('filterDateTo').value = '';
                    document.getElementById('clearSearch').classList.remove('visible');
                    filterAndDisplayRequests();
                });
            }

            // ‚úÖ YOUR EXISTING FUNCTIONS (keep all of these exactly as they are)

            function formatDate(dateValue) {
                if (!dateValue) return 'N/A';

                try {
                    if (dateValue.toDate) {
                        const date = dateValue.toDate();
                        return date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                        });
                    }

                    if (typeof dateValue === 'string') {
                        return dateValue;
                    }

                    if (dateValue instanceof Date) {
                        return dateValue.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                        });
                    }
                } catch (error) {
                    console.error('Error formatting date:', error);
                }

                return 'N/A';
            }

            function getStatusClass(status) {
                const statusLower = (status || '').toLowerCase();
                if (statusLower.includes('progress') || statusLower.includes('processing')) return 'status-processing';
                if (statusLower.includes('waiting')) return 'status-waiting';
                if (statusLower.includes('approved')) return 'status-Approved';
                if (statusLower.includes('completed')) return 'status-Completed';
                if (statusLower.includes('rejected')) return 'status-rejected';
                return 'status-waiting';
            }

            function formatStatus(status) {
                if (!status) return 'Waiting';
                return status;
            }

            function mapCollegeName(oldName) {
                const collegeMapping = {
                    'Applied': 'College of Applied Studies',
                    'Arts': 'College of Arts',
                    'Business': 'College of Business Adminstration',
                    'Engineering': 'College of Engineering',
                    'Health': 'College of Health & Sport Sciences',
                    'IT': 'College of Information Technology',
                    'Law': 'College of Law',
                    'Science': 'College of Science',
                    'Alumni': 'Alumni Club',
                    'BIC': 'Business Incubator Center',
                    'Counselling': 'Career Counselling Office',
                    'French': 'Centre D\'√©tudes Fran√ßaises',
                    'Cloud': 'Cloud Innovation Center',
                    'CI': 'Confucius Institiute',
                    'E-Learning': 'E-Learning Center',
                    'English': 'English Language Center',
                    'ITC': 'Information Technology Center',
                    'Follow-up': 'Information and Follow-up Office',
                    'Korean': 'King Sejong Institiite for Teaching Korean',
                    'Legal': 'Legal Clinic & Human Rights Centre',
                    'Media': 'Media Center',
                    'QA': 'Quality Assurance and Accrediation Centre',
                    'Teaching': 'Unit for Teaching Excellence and Leadership',
                    'Turkish': 'Yunus Emre Institiute for Teaching Turkish'
                };

                return collegeMapping[oldName] || oldName;
            }

            function updateStats(requests) {
                const stats = {
                    total: requests.length,
                    waiting: 0,
                    inProgress: 0,
                    rejected: 0
                };

                requests.forEach(req => {
                    const status = (req.Status || '').toLowerCase();
                    if (status.includes('progress') || status.includes('processing')) {
                        stats.inProgress++;
                    } else if (status.includes('waiting') || status.includes('pending')) {
                        stats.waiting++;
                    } else if (status.includes('rejected')) {
                        stats.rejected++;
                    }
                });

                const totalElement = document.getElementById('stat-total');
                const waitingElement = document.getElementById('stat-waiting');
                const processingElement = document.getElementById('stat-processing');
                const rejectedElement = document.getElementById('stat-rejected');

                if (totalElement) totalElement.textContent = stats.total;
                if (waitingElement) waitingElement.textContent = stats.waiting;
                if (processingElement) processingElement.textContent = stats.inProgress;
                if (rejectedElement) rejectedElement.textContent = stats.rejected;
            }

            function filterAndDisplayRequests() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const filterCollege = document.getElementById('filterCollege').value;
                const filterStatus = document.getElementById('filterStatus').value;
                const filterDateFrom = document.getElementById('filterDateFrom').value;
                const filterDateTo = document.getElementById('filterDateTo').value;

                const clearSearchBtn = document.getElementById('clearSearch');
                if (searchTerm) {
                    clearSearchBtn.classList.add('visible');
                } else {
                    clearSearchBtn.classList.remove('visible');
                }

                const tbody = document.getElementById("tickets-tbody");
                const table = document.getElementById("requests-table");
                tbody.innerHTML = "";

                filteredRequests = allRequestsData.filter(data => {
                    const matchesSearch = !searchTerm ||
                        (data['Request Number'] || '').toLowerCase().includes(searchTerm) ||
                        (data.Description || '').toLowerCase().includes(searchTerm) ||
                        (data.Location || '').toLowerCase().includes(searchTerm) ||
                        (data.College || '').toLowerCase().includes(searchTerm) ||
                        (data.Department || '').toLowerCase().includes(searchTerm);

                    const matchesCollege = !filterCollege || mapCollegeName(data.College) === filterCollege;

                    const matchesStatus = !filterStatus || (() => {
                        const dataStatus = (data.Status || 'Waiting').trim().toLowerCase();
                        const filterStatusLower = filterStatus.trim().toLowerCase();
                        return dataStatus === filterStatusLower;
                    })();

                    let matchesDate = true;
                    if (filterDateFrom || filterDateTo) {
                        const requestDate = data['Request Date']?.toDate ? data['Request Date'].toDate() :
                            data.Date?.toDate ? data.Date.toDate() :
                                new Date(data['Request Date'] || data.Date);
                        const fromDate = filterDateFrom ? new Date(filterDateFrom) : null;
                        const toDate = filterDateTo ? new Date(filterDateTo + 'T23:59:59') : null;

                        if (fromDate && requestDate < fromDate) matchesDate = false;
                        if (toDate && requestDate > toDate) matchesDate = false;
                    }

                    return matchesSearch && matchesCollege && matchesStatus && matchesDate;
                });

                if (filteredRequests.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No requests match your filters</td></tr>';
                    table.style.display = "table";
                    document.getElementById('pagination-container').style.display = 'none';
                    return;
                }

                const totalPages = Math.ceil(filteredRequests.length / rowsPerPage);
                const startIndex = (currentPage - 1) * rowsPerPage;
                const endIndex = startIndex + rowsPerPage;
                const paginatedRequests = filteredRequests.slice(startIndex, endIndex);

                paginatedRequests.forEach((data) => {
                    const status = formatStatus(data.Status);
                    const statusClass = getStatusClass(status);

                    const row = document.createElement("tr");
                    row.innerHTML = `
                <td><a href="#" class="request-link" onclick="viewRequestDetails('${data['Request Number']}'); return false;">${data['Request Number'] || 'N/A'}</a></td>
                <td><span class="${statusClass}">${status}</span></td>
                <td>${mapCollegeName(data.College) || 'N/A'}</td>
                <td>${data.Department || 'N/A'}</td>
                <td>${data.Location || 'N/A'}</td>
                <td>${data.Description || data.Issue || 'N/A'}</td>
                <td>${formatDate(data['Request Date'] || data['Date'])}</td>
            `;
                    tbody.appendChild(row);
                });

                table.style.display = "table";
                updateStats(filteredRequests);
                updatePaginationUI(totalPages, startIndex, endIndex);
            }

            function updatePaginationUI(totalPages, startIndex, endIndex) {
                const paginationContainer = document.getElementById('pagination-container');
                const paginationInfo = document.getElementById('pagination-info');
                const pageNumbers = document.getElementById('pageNumbers');
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');

                if (filteredRequests.length === 0) {
                    paginationContainer.style.display = 'none';
                    return;
                }

                paginationContainer.style.display = 'flex';

                const showing = Math.min(endIndex, filteredRequests.length);
                paginationInfo.textContent = `Showing ${startIndex + 1}-${showing} of ${filteredRequests.length} requests`;

                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;

                pageNumbers.innerHTML = '';
                const maxVisiblePages = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

                if (endPage - startPage < maxVisiblePages - 1) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }

                if (startPage > 1) {
                    const firstPage = document.createElement('button');
                    firstPage.className = 'page-number';
                    firstPage.textContent = '1';
                    firstPage.onclick = () => goToPage(1);
                    pageNumbers.appendChild(firstPage);

                    if (startPage > 2) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.style.padding = '8px';
                        ellipsis.style.color = '#666';
                        pageNumbers.appendChild(ellipsis);
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => goToPage(i);
                    pageNumbers.appendChild(pageBtn);
                }

                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsis = document.createElement('span');
                        ellipsis.textContent = '...';
                        ellipsis.style.padding = '8px';
                        ellipsis.style.color = '#666';
                        pageNumbers.appendChild(ellipsis);
                    }

                    const lastPage = document.createElement('button');
                    lastPage.className = 'page-number';
                    lastPage.textContent = totalPages;
                    lastPage.onclick = () => goToPage(totalPages);
                    pageNumbers.appendChild(lastPage);
                }
            }

            window.goToPage = function (page) {
                currentPage = page;
                filterAndDisplayRequests();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            window.nextPage = function () {
                if (currentPage < Math.ceil(filteredRequests.length / rowsPerPage)) {
                    currentPage++;
                    filterAndDisplayRequests();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            window.prevPage = function () {
                if (currentPage > 1) {
                    currentPage--;
                    filterAndDisplayRequests();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            };

            window.changeRowsPerPage = function () {
                rowsPerPage = parseInt(document.getElementById('rowsPerPage').value);
                currentPage = 1;
                filterAndDisplayRequests();
            };

            async function loadRequests() {
                const tbody = document.getElementById("tickets-tbody");
                const loadingDiv = document.getElementById("loading");
                const errorDiv = document.getElementById("error");
                const table = document.getElementById("requests-table");

                try {
                    tbody.innerHTML = "";
                    loadingDiv.style.display = "block";
                    errorDiv.style.display = "none";
                    table.style.display = "none";

                    const requestsSnapshot = await getDocs(collection(db, "Requests"));

                    loadingDiv.style.display = "none";

                    if (requestsSnapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No requests found</td></tr>';
                        table.style.display = "table";
                        return;
                    }

                    allRequestsData = [];
                    requestsSnapshot.forEach((docSnap) => {
                        allRequestsData.push(docSnap.data());
                    });

                    allRequestsData.sort((a, b) => {
                        const dateA = a['Request Date']?.toDate?.() || a.Date?.toDate?.() || new Date(a['Request Date'] || a.Date || 0);
                        const dateB = b['Request Date']?.toDate?.() || b.Date?.toDate?.() || new Date(b['Request Date'] || b.Date || 0);
                        return dateB - dateA;
                    });

                    console.log('‚úÖ Loaded requests:', allRequestsData.length);

                    filterAndDisplayRequests();

                } catch (error) {
                    console.error("Error loading requests:", error);
                    loadingDiv.style.display = "none";
                    errorDiv.textContent = `Error loading requests: ${error.message}`;
                    errorDiv.style.display = "block";
                }
            }

            function applyURLFilter() {
                const urlParams = new URLSearchParams(window.location.search);
                const urlFilter = urlParams.get('status');
                const dateFrom = urlParams.get('dateFrom');
                const dateTo = urlParams.get('dateTo');

                console.log('=== URL FILTER DEBUG ===');
                console.log('URL:', window.location.href);
                console.log('Status Filter:', urlFilter);
                console.log('Date From:', dateFrom);
                console.log('Date To:', dateTo);

                if (urlFilter) {
                    let statusValue = '';

                    if (urlFilter.toLowerCase() === 'waiting') statusValue = 'Waiting';
                    else if (urlFilter.toLowerCase() === 'processing') statusValue = 'Processing';
                    else if (urlFilter.toLowerCase() === 'approved') statusValue = 'Approved';
                    else if (urlFilter.toLowerCase() === 'rejected') statusValue = 'Rejected';
                    else if (urlFilter.toLowerCase() === 'completed') statusValue = 'Completed';

                    if (statusValue) {
                        console.log('Setting filter dropdown to:', statusValue);
                        document.getElementById('filterStatus').value = statusValue;

                        document.querySelectorAll('.stat-card').forEach(card => {
                            card.classList.remove('active');
                        });

                        if (statusValue === 'Waiting') {
                            document.getElementById('card-waiting').classList.add('active');
                        } else if (statusValue === 'Processing') {
                            document.getElementById('card-processing').classList.add('active');
                        } else if (statusValue === 'Rejected') {
                            document.getElementById('card-rejected').classList.add('active');
                        }
                    }
                }

                if (dateFrom) {
                    console.log('Setting dateFrom filter to:', dateFrom);
                    document.getElementById('filterDateFrom').value = dateFrom;
                }

                if (dateTo) {
                    console.log('Setting dateTo filter to:', dateTo);
                    document.getElementById('filterDateTo').value = dateTo;
                }

                console.log('Calling filterAndDisplayRequests()...');
                filterAndDisplayRequests();
                console.log('========================');
            }

            window.clearSearchInput = function () {
                document.getElementById('searchInput').value = '';
                document.getElementById('clearSearch').classList.remove('visible');
                filterAndDisplayRequests();
            };

            window.filterByStatus = function (status) {
                document.getElementById('filterStatus').value = status;

                document.querySelectorAll('.stat-card').forEach(card => {
                    card.classList.remove('active');
                });

                if (status === '') {
                    document.getElementById('card-total').classList.add('active');
                } else if (status === 'Waiting') {
                    document.getElementById('card-waiting').classList.add('active');
                } else if (status === 'Processing') {
                    document.getElementById('card-processing').classList.add('active');
                } else if (status === 'Rejected') {
                    document.getElementById('card-rejected').classList.add('active');
                }

                filterAndDisplayRequests();
            };

            // ‚úÖ MODAL AND APPROVAL FUNCTIONS
            window.closeModal = function () {
                const modal = document.getElementById('requestModal');
                if (modal) {
                    modal.remove();
                }
                document.body.classList.remove('modal-open');
            };

            window.showRejectDialog = function (requestNumber) {
                const rejectionSection = document.getElementById('rejectionSection');
                if (rejectionSection) {
                    rejectionSection.style.display = 'block';
                    document.getElementById('rejectionReason').focus();
                }
            };

            window.cancelReject = function () {
                const rejectionSection = document.getElementById('rejectionSection');
                if (rejectionSection) {
                    rejectionSection.style.display = 'none';
                    document.getElementById('rejectionReason').value = '';
                }
            };

            window.approveRequest = async function (requestNumber) {
                try {
                    const requestsRef = collection(db, 'Requests');
                    const q = query(requestsRef);
                    const querySnapshot = await getDocs(q);

                    let docId = null;

                    querySnapshot.forEach((docSnap) => {
                        if (docSnap.data()['Request Number'] === requestNumber) {
                            docId = docSnap.id;
                        }
                    });

                    if (docId) {
                        await updateDoc(doc(db, 'Requests', docId), {
                            'Director Approval': 'Approved',
                            'Status': 'Approved',
                            'Approved Date': serverTimestamp(),
                            'Approved By': sessionStorage.getItem('userEmail') || 'Director'
                        });

                        alert(`‚úÖ Request ${requestNumber} has been approved!`);

                        closeModal();
                        await loadRequests();
                    } else {
                        alert('Error: Request not found in database');
                    }
                } catch (error) {
                    console.error('Error approving request:', error);
                    alert('Error: ' + error.message);
                }
            };

            window.confirmReject = async function (requestNumber) {
                const reason = document.getElementById('rejectionReason').value.trim();

                if (!reason) {
                    alert('Please provide a reason for rejection');
                    document.getElementById('rejectionReason').focus();
                    return;
                }

                try {
                    const requestsRef = collection(db, 'Requests');
                    const q = query(requestsRef);
                    const querySnapshot = await getDocs(q);

                    let docId = null;
                    let requestData = null;

                    querySnapshot.forEach((docSnap) => {
                        if (docSnap.data()['Request Number'] === requestNumber) {
                            docId = docSnap.id;
                            requestData = docSnap.data();
                        }
                    });

                    if (docId) {
                        await updateDoc(doc(db, 'Requests', docId), {
                            'Status': 'Rejected',
                            'Rejection Reason': reason,
                            'Rejected By': sessionStorage.getItem('userEmail') || 'Director',
                            'Rejection Date': serverTimestamp()
                        });

                        alert(`‚úÖ Request ${requestNumber} has been rejected.\n\nRejection reason: ${reason}`);

                        closeModal();
                        await loadRequests();
                    } else {
                        alert('Error: Request not found in database');
                    }
                } catch (error) {
                    console.error('Error rejecting request:', error);
                    alert('Error: ' + error.message);
                }
            };

            window.viewRequestDetails = function (requestNumber) {
                const request = allRequestsData.find(req => req['Request Number'] === requestNumber);

                if (!request) {
                    alert('Request not found');
                    return;
                }

                const status = (request.Status || 'Waiting').toLowerCase();
                const showApprovalButtons = status === 'waiting' || status.includes('waiting');

                const modalHTML = `
            <div id="requestModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
                <div style="background: white; border-radius: 12px; padding: 30px; max-width: 700px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;">
<button onclick="closeModal()" style="position: absolute; top: 15px; right: 15px; background: #e0e0e0; color: #333; border: none; width: 35px; height: 35px; border-radius: 50%; font-size: 20px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; padding: 0;" onmouseover="this.style.background='var(--teal)'; this.style.color='white'" onmouseout="this.style.background='#e0e0e0'; this.style.color='#333'">√ó</button>
<h2 style="color: var(--navy); margin-bottom: 20px; font-size: 24px; border-bottom: 2px solid var(--navy); padding-bottom: 10px; padding-right: 40px;">Request Details</h2>                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Request Number:</p>
                            <p style="color:var(--teal); font-weight: bold; font-size: 18px;">${request['Request Number']}</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Status:</p>
                            <p><span class="${getStatusClass(request.Status)}" style="padding: 6px 12px; border-radius: 20px; display: inline-block;">${request.Status || 'Waiting'}</span></p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Date:</p>
                            <p style="color: #2c3e50;">${formatDate(request.Date)}</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Submitted by:</p>
                            <p style="color: #2c3e50;">${request['Submitted by'] || 'N/A'}</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">College:</p>
                            <p style="color: #2c3e50;">${mapCollegeName(request.College) || 'N/A'}</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Department:</p>
                            <p style="color: #2c3e50;">${request.Department || 'N/A'}</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Location Type:</p>
                            <p style="color: #2c3e50;">${request['Location Type'] || 'N/A'}</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Location:</p>
                            <p style="color: #2c3e50;">${request.Location || 'N/A'}</p>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <p style="font-weight: 600; color: #666; margin-bottom: 5px;">Issue Description:</p>
                        <p style="color: #2c3e50; background: #f5f5f5; padding: 15px; border-radius: 8px; line-height: 1.6; white-space: pre-wrap;">${request.Description || 'N/A'}</p>
                    </div>

                    ${showApprovalButtons ? `
                    <div style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
<button onclick="approveRequest('${request['Request Number']}')" style="background: var(--navy); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='var(--teal)'" onmouseout="this.style.background='var(--navy)'">Approve</button>                            
<button onclick="showRejectDialog('${request['Request Number']}')" style="background: var(--teal); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#e74c3c'" onmouseout="this.style.background='var(--teal)'">Reject</button>                        </div>
                        
                        <div id="rejectionSection" style="display: none; margin-top: 15px;">
                            <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px; font-size: 14px;">Rejection Reason: <span style="color: #e74c3c;">*</span></label>
                            <textarea id="rejectionReason" placeholder="Please provide a reason for rejection..." style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; resize: vertical; min-height: 100px;"></textarea>
                            
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="confirmReject('${request['Request Number']}')" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Confirm Rejection</button>
                                <button onclick="cancelReject()" style="background: #95a5a6; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">Cancel</button>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            </div>
        `;

                document.body.insertAdjacentHTML('beforeend', modalHTML);
                document.body.classList.add('modal-open');

                document.getElementById('requestModal').addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeModal();
                    }
                });
            };
        </script>
        <script>
            // Global dashboard navigation based on user role
            window.goToDashboard = function () {
                const role = sessionStorage.getItem('userRole');

                console.log('üöÄ Dashboard clicked - Role:', role);

                if (!role) {
                    console.warn('‚ö†Ô∏è No role found, redirecting to default');
                    window.location.href = 'all-requests-d.html';
                    return;
                }

                const roleLower = role.toLowerCase();

                if (roleLower === 'director') {
                    console.log('üëë Redirecting to Director Dashboard');
                    window.location.href = 'director-dashboard.html';
                } else if (roleLower === 'admin') {
                    console.log('üõ†Ô∏è Redirecting to Admin Dashboard');
                    window.location.href = 'admin-dashboard.html';
                } else {
                    console.log('üìù Redirecting to Default Dashboard');
                    window.location.href = 'all-requests-d.html';
                }
            };
        </script>
</body>

</html>